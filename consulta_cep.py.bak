import streamlit as st
import requests
from PIL import Image

# Fun√ß√£o para consultar cidade e rua via API do ViaCEP
def buscar_endereco_por_cep(cep):
    try:
        cep = cep.replace("-", "").strip()
        if not cep.isdigit() or len(cep) != 8:
            return ("FORMATO DE CEP INV√ÅLIDO", None)
        url = f"https://viacep.com.br/ws/{cep}/json/"
        response = requests.get(url)
        data = response.json()
        if "erro" in data:
            return ("CEP N√ÉO ENCONTRADO", None)
        cidade = data.get("localidade", "CIDADE N√ÉO IDENTIFICADA")
        rua = data.get("logradouro", "RUA N√ÉO INFORMADA")
        return (cidade, rua)
    except:
        return ("ERRO NA CONSULTA", None)

# Lista de cidades com atendimento dispon√≠vel
cidades_disponiveis = [
    "S√£o Paulo", "Guarulhos", "Osasco", "Santo Andr√©", "S√£o Bernardo do Campo",
    "Diadema", "Barueri", "Carapicu√≠ba", "Mau√°", "Suzano", "Tabo√£o da Serra",
    "Embu das Artes", "Itapevi", "Ferraz de Vasconcelos", "Francisco Morato",
    "Franco da Rocha", "Caieiras", "Cotia", "Po√°", "Ribeir√£o Pires",
    "Rio Grande da Serra", "Santa Isabel", "Santana de Parna√≠ba", "Aruj√°",
    "Embu-Gua√ßu", "Itapecerica da Serra", "Jandira", "Mairipor√£", "Vargem Grande Paulista",
    "Jundia√≠", "S√£o Caetano do Sul", "Alphaville (Barueri)"
]

# Layout da p√°gina
st.set_page_config(page_title="Consulta √Årea Atendimento", layout="centered")

# Logo centralizado
col1, col2, col3 = st.columns([1, 2, 1])
with col2:
    try:
        logo = Image.open("logo.png")
        st.image(logo, width=150)
    except:
        st.warning("‚ö†Ô∏è Logo n√£o encontrado. Certifique-se de que 'logo.png' est√° na mesma pasta do script.")

# T√≠tulo e instru√ß√£o
st.title("üîç Consulta de Atendimento por CEP")
st.markdown("Digite um CEP v√°lido para verificar se h√° atendimento dispon√≠vel.")

# Campo de entrada de CEP
cep_input = st.text_input("CEP (Ex: 07010-000 ou 07010000)", max_chars=9)

if cep_input:
    cidade, rua = buscar_endereco_por_cep(cep_input)

    st.write(f"üìç **Cidade:** {cidade}")
    if rua:
        st.write(f"üì¨ **Rua:** {rua}")

    if cidade in cidades_disponiveis:
        st.success("‚úÖ ATENDIMENTO DISPON√çVEL")
    elif cidade in ["CEP N√ÉO ENCONTRADO", "FORMATO DE CEP INV√ÅLIDO", "ERRO NA CONSULTA", "CIDADE N√ÉO IDENTIFICADA"]:
        st.error(f"‚ùå {cidade}")
    else:
        st.warning("‚ö†Ô∏è INDISPONIBILIDADE DE ATENDIMENTO")

# Rodap√©
st.markdown("---")
st.caption("Sistema automatizado de consulta baseado na API ViaCEP e lista de cobertura da RMSP.")
